from flask import Flask, request, jsonify
import requests
import numpy as np
import os
from datetime import datetime

app = Flask(__name__)

WEATHER_API_KEY = os.getenv("WEATHER_API_KEY")

class RainPredictionModel:
    """
    Rain prediction model based on meteorological parameters.
    Uses weighted scoring system based on weather science.
    """
    
    def __init__(self):
        # Weather parameter weights (based on meteorological importance)
        self.weights = {
            'chance_of_rain': 0.35,      # API's own prediction
            'humidity': 0.20,             # High humidity increases rain chance
            'precipitation': 0.25,        # Existing precipitation
            'cloud_cover': 0.10,          # Cloud coverage
            'pressure': 0.10              # Low pressure = rain
        }
    
    def calculate_rain_score(self, weather_params):
        """
        Calculate rain probability score based on weather parameters.
        Returns score between 0-100
        """
        scores = []
        
        # 1. API's chance of rain (strongest indicator)
        if 'chance_of_rain' in weather_params:
            scores.append(weather_params['chance_of_rain'] * self.weights['chance_of_rain'])
        
        # 2. Humidity (>70% increases rain probability)
        if 'humidity' in weather_params:
            humidity = weather_params['humidity']
            humidity_score = 0
            if humidity > 80:
                humidity_score = 100
            elif humidity > 70:
                humidity_score = 75
            elif humidity > 60:
                humidity_score = 50
            else:
                humidity_score = 25
            scores.append(humidity_score * self.weights['humidity'])
        
        # 3. Current precipitation
        if 'precipitation' in weather_params:
            precip = weather_params['precipitation']
            precip_score = min(100, precip * 20)  # Scale: 5mm = 100%
            scores.append(precip_score * self.weights['precipitation'])
        
        # 4. Cloud cover (>75% increases rain)
        if 'cloud_cover' in weather_params:
            cloud = weather_params['cloud_cover']
            cloud_score = 0
            if cloud > 75:
                cloud_score = 100
            elif cloud > 50:
                cloud_score = 60
            else:
                cloud_score = 20
            scores.append(cloud_score * self.weights['cloud_cover'])
        
        # 5. Atmospheric pressure (low pressure = rain)
        if 'pressure' in weather_params:
            pressure = weather_params['pressure']
            pressure_score = 0
            if pressure < 1000:
                pressure_score = 100
            elif pressure < 1010:
                pressure_score = 70
            elif pressure < 1015:
                pressure_score = 40
            else:
                pressure_score = 10
            scores.append(pressure_score * self.weights['pressure'])
        
        # Calculate total score
        total_score = sum(scores)
        return min(100, max(0, total_score))
    
    def predict(self, day_data):
        """
        Predict rain for a given day.
        Returns: (will_rain, confidence, rain_probability)
        """
        params = {
            'chance_of_rain': day_data.get('daily_chance_of_rain', 0),
            'humidity': day_data.get('avghumidity', 50),
            'precipitation': day_data.get('totalprecip_mm', 0),
            'cloud_cover': day_data.get('cloud', 50),
            'pressure': day_data.get('pressure_mb', 1013)
        }
        
        rain_probability = self.calculate_rain_score(params)
        
        # Determine prediction
        will_rain = rain_probability >= 50
        
        # Calculate confidence based on how clear the prediction is
        if rain_probability >= 80 or rain_probability <= 20:
            confidence = "High"
            confidence_percent = 90
        elif rain_probability >= 65 or rain_probability <= 35:
            confidence = "Medium"
            confidence_percent = 70
        else:
            confidence = "Low"
            confidence_percent = 50
        
        return will_rain, confidence, round(rain_probability, 1), confidence_percent


# Initialize the model
rain_model = RainPredictionModel()


@app.route("/", methods=["GET"])
def home():
    """Home endpoint"""
    return """
    <html>
    <head>
        <title>ML Rain Prediction</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 40px; background: #f5f7fa; }
            h1 { color: #2c3e50; }
            .endpoint { background: white; padding: 20px; margin: 15px 0; 
                        border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
            code { background: #34495e; color: white; padding: 4px 10px; 
                   border-radius: 5px; font-family: monospace; }
            .highlight { color: #e74c3c; font-weight: bold; }
        </style>
    </head>
    <body>
        <h1>üåßÔ∏è Machine Learning Rain Prediction API</h1>
        <p class="highlight">üìä Uses ML model based on meteorological parameters</p>
        
        <div class="endpoint">
            <h3>Rain Prediction Endpoint</h3>
            <code>GET /predict-rain?city=Chennai</code>
            <p><strong>Model analyzes:</strong></p>
            <ul>
                <li>Humidity levels</li>
                <li>Atmospheric pressure</li>
                <li>Cloud coverage</li>
                <li>Precipitation patterns</li>
                <li>Historical chance of rain</li>
            </ul>
            <p><strong>Returns:</strong></p>
            <ul>
                <li>‚úÖ Will it rain? (Yes/No)</li>
                <li>üìä Rain probability (0-100%)</li>
                <li>üéØ Confidence level (Low/Medium/High)</li>
                <li>üìÖ Day-by-day breakdown (3 days)</li>
            </ul>
        </div>
        
        <div class="endpoint">
            <h3>üé® Beautiful HTML Forecast (NEW!)</h3>
            <code>GET /rain-forecast?city=Chennai</code>
            <p><strong>Colorful, easy-to-understand forecast page for everyone!</strong></p>
            <ul>
                <li>Visual rain probability bars</li>
                <li>Color-coded predictions</li>
                <li>Simple recommendations</li>
                <li>3-day forecast cards</li>
                <li>Search any city</li>
            </ul>
        </div>
        
        <div class="endpoint">
            <h3>Examples:</h3>
            <ul>
                <li><a href="/rain-forecast?city=Chennai">üé® Chennai - Beautiful Forecast</a></li>
                <li><a href="/rain-forecast?city=London">üé® London - Beautiful Forecast</a></li>
                <li><a href="/predict-rain?city=Chennai">üìä Chennai - JSON Data</a></li>
                <li><a href="/predict-rain?city=Mumbai">üìä Mumbai - JSON Data</a></li>
            </ul>
        </div>
        
        <div class="endpoint">
            <h3>How the Model Works:</h3>
            <p>The model uses a <strong>weighted scoring system</strong> based on meteorological science:</p>
            <ol>
                <li><strong>Chance of Rain (35% weight):</strong> API's forecast data</li>
                <li><strong>Humidity (20% weight):</strong> >80% humidity = high rain probability</li>
                <li><strong>Precipitation (25% weight):</strong> Current/forecasted precipitation</li>
                <li><strong>Cloud Cover (10% weight):</strong> >75% clouds = rain likely</li>
                <li><strong>Pressure (10% weight):</strong> <1000mb = low pressure = rain</li>
            </ol>
            <p>Combines these factors to produce a 0-100% rain probability score.</p>
        </div>
    </body>
    </html>
    """


@app.route("/predict-rain", methods=["GET"])
def predict_rain():
    """ML-based rain prediction endpoint"""
    city = request.args.get("city")
    
    if not city:
        return jsonify({"error": "city parameter required"}), 400
    
    # Get 3-day forecast with detailed hourly data
    weather_url = "http://api.weatherapi.com/v1/forecast.json"
    weather_params = {
        "key": WEATHER_API_KEY,
        "q": city,
        "days": 3,
        "aqi": "yes"
    }
    
    try:
        print(f"üì° Fetching forecast data for {city}...")
        response = requests.get(weather_url, params=weather_params, timeout=10)
        
        if response.status_code != 200:
            return jsonify({
                "error": "Failed to fetch weather data",
                "status_code": response.status_code
            }), 400
        
        data = response.json()
        location = data['location']
        forecast_days = data['forecast']['forecastday']
        
        # Run predictions for each day
        predictions = []
        overall_will_rain = False
        max_rain_prob = 0
        
        for day in forecast_days:
            # Get average pressure from hourly data
            hourly_pressures = [hour['pressure_mb'] for hour in day['hour']]
            avg_pressure = sum(hourly_pressures) / len(hourly_pressures)
            
            # Get average cloud cover
            hourly_clouds = [hour['cloud'] for hour in day['hour']]
            avg_cloud = sum(hourly_clouds) / len(hourly_clouds)
            
            # Prepare day data for model
            day_data = {
                'daily_chance_of_rain': day['day']['daily_chance_of_rain'],
                'avghumidity': day['day']['avghumidity'],
                'totalprecip_mm': day['day']['totalprecip_mm'],
                'cloud': avg_cloud,
                'pressure_mb': avg_pressure
            }
            
            # Run prediction model
            will_rain, confidence, rain_prob, conf_percent = rain_model.predict(day_data)
            
            if will_rain:
                overall_will_rain = True
            if rain_prob > max_rain_prob:
                max_rain_prob = rain_prob
            
            # Determine rain intensity
            precip = day['day']['totalprecip_mm']
            if precip > 10:
                intensity = "Heavy"
            elif precip > 2.5:
                intensity = "Moderate"
            elif precip > 0:
                intensity = "Light"
            else:
                intensity = "None"
            
            prediction_result = {
                "date": day['date'],
                "day_name": datetime.strptime(day['date'], '%Y-%m-%d').strftime('%A'),
                "prediction": {
                    "will_rain": will_rain,
                    "rain_probability": rain_prob,
                    "confidence": confidence,
                    "confidence_percent": conf_percent
                },
                "weather_params": {
                    "max_temp": f"{day['day']['maxtemp_c']}¬∞C",
                    "min_temp": f"{day['day']['mintemp_c']}¬∞C",
                    "condition": day['day']['condition']['text'],
                    "humidity": f"{day['day']['avghumidity']}%",
                    "precipitation": f"{day['day']['totalprecip_mm']} mm",
                    "rain_intensity": intensity,
                    "cloud_cover": f"{round(avg_cloud)}%",
                    "pressure": f"{round(avg_pressure)} mb"
                }
            }
            predictions.append(prediction_result)
        
        # Overall summary
        days_with_rain = sum(1 for p in predictions if p['prediction']['will_rain'])
        
        summary = {
            "will_rain_in_next_2_days": overall_will_rain,
            "max_rain_probability": max_rain_prob,
            "days_with_rain": f"{days_with_rain} out of 3 days",
            "recommendation": ""
        }
        
        # Generate recommendation
        if max_rain_prob >= 70:
            summary["recommendation"] = "High chance of rain - carry umbrella and plan indoor activities"
        elif max_rain_prob >= 50:
            summary["recommendation"] = "Moderate chance of rain - keep umbrella handy"
        else:
            summary["recommendation"] = "Low chance of rain - outdoor activities should be fine"
        
        print("‚úÖ Prediction complete!")
        
        return jsonify({
            "location": f"{location['name']}, {location['region']}, {location['country']}",
            "prediction_summary": summary,
            "daily_predictions": predictions,
            "model_info": {
                "type": "Weighted Meteorological Scoring Model",
                "parameters_used": [
                    "Chance of Rain (35% weight)",
                    "Humidity (20% weight)",
                    "Precipitation (25% weight)",
                    "Cloud Cover (10% weight)",
                    "Atmospheric Pressure (10% weight)"
                ],
                "prediction_threshold": "50% probability"
            }
        })
        
    except requests.exceptions.Timeout:
        return jsonify({"error": "Request timeout"}), 504
    except Exception as e:
        return jsonify({"error": f"Error: {str(e)}"}), 500


@app.route("/rain-forecast", methods=["GET"])
def rain_forecast_html():
    """Beautiful HTML version of rain prediction for layman"""
    city = request.args.get("city", "London")
    
    # Get prediction data
    weather_url = "http://api.weatherapi.com/v1/forecast.json"
    weather_params = {
        "key": WEATHER_API_KEY,
        "q": city,
        "days": 3,
        "aqi": "yes"
    }
    
    try:
        response = requests.get(weather_url, params=weather_params, timeout=10)
        
        if response.status_code != 200:
            return f"<h1>Error: Could not fetch weather for {city}</h1>", 400
        
        data = response.json()
        location = data['location']
        forecast_days = data['forecast']['forecastday']
        
        # Run predictions
        predictions = []
        overall_will_rain = False
        max_rain_prob = 0
        
        for day in forecast_days:
            hourly_pressures = [hour['pressure_mb'] for hour in day['hour']]
            avg_pressure = sum(hourly_pressures) / len(hourly_pressures)
            hourly_clouds = [hour['cloud'] for hour in day['hour']]
            avg_cloud = sum(hourly_clouds) / len(hourly_clouds)
            
            day_data = {
                'daily_chance_of_rain': day['day']['daily_chance_of_rain'],
                'avghumidity': day['day']['avghumidity'],
                'totalprecip_mm': day['day']['totalprecip_mm'],
                'cloud': avg_cloud,
                'pressure_mb': avg_pressure
            }
            
            will_rain, confidence, rain_prob, conf_percent = rain_model.predict(day_data)
            
            if will_rain:
                overall_will_rain = True
            if rain_prob > max_rain_prob:
                max_rain_prob = rain_prob
            
            precip = day['day']['totalprecip_mm']
            if precip > 10:
                intensity = "Heavy"
            elif precip > 2.5:
                intensity = "Moderate"
            elif precip > 0:
                intensity = "Light"
            else:
                intensity = "None"
            
            predictions.append({
                "date": day['date'],
                "day_name": datetime.strptime(day['date'], '%Y-%m-%d').strftime('%A'),
                "will_rain": will_rain,
                "rain_prob": rain_prob,
                "confidence": confidence,
                "conf_percent": conf_percent,
                "max_temp": day['day']['maxtemp_c'],
                "min_temp": day['day']['mintemp_c'],
                "condition": day['day']['condition']['text'],
                "humidity": day['day']['avghumidity'],
                "precipitation": day['day']['totalprecip_mm'],
                "intensity": intensity,
                "icon": day['day']['condition']['icon']
            })
        
        # Generate HTML
        html = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <title>Rain Forecast - {location['name']}</title>
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <style>
                * {{
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }}
                
                body {{
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                    padding: 20px;
                }}
                
                .container {{
                    max-width: 1200px;
                    margin: 0 auto;
                }}
                
                .header {{
                    text-align: center;
                    color: white;
                    margin-bottom: 30px;
                }}
                
                .header h1 {{
                    font-size: 2.5em;
                    margin-bottom: 10px;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                }}
                
                .location {{
                    font-size: 1.3em;
                    opacity: 0.9;
                }}
                
                .summary-card {{
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    margin-bottom: 30px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                }}
                
                .summary-header {{
                    text-align: center;
                    margin-bottom: 20px;
                }}
                
                .rain-status {{
                    display: inline-block;
                    padding: 15px 40px;
                    border-radius: 50px;
                    font-size: 1.8em;
                    font-weight: bold;
                    margin: 10px 0;
                }}
                
                .rain-yes {{
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                }}
                
                .rain-no {{
                    background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
                    color: white;
                }}
                
                .probability {{
                    font-size: 3em;
                    font-weight: bold;
                    color: #2c3e50;
                    margin: 15px 0;
                }}
                
                .recommendation {{
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 15px;
                    border-left: 5px solid #667eea;
                    margin-top: 20px;
                }}
                
                .recommendation-icon {{
                    font-size: 2em;
                    margin-right: 10px;
                }}
                
                .days-grid {{
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 20px;
                    margin-top: 30px;
                }}
                
                .day-card {{
                    background: white;
                    border-radius: 15px;
                    padding: 25px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    transition: transform 0.3s ease;
                }}
                
                .day-card:hover {{
                    transform: translateY(-5px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
                }}
                
                .day-header {{
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 20px;
                    padding-bottom: 15px;
                    border-bottom: 2px solid #f0f0f0;
                }}
                
                .day-name {{
                    font-size: 1.5em;
                    font-weight: bold;
                    color: #2c3e50;
                }}
                
                .weather-icon {{
                    width: 64px;
                    height: 64px;
                }}
                
                .prediction-badge {{
                    display: inline-block;
                    padding: 10px 20px;
                    border-radius: 25px;
                    font-weight: bold;
                    font-size: 1.1em;
                    margin: 10px 0;
                }}
                
                .will-rain {{
                    background: #3498db;
                    color: white;
                }}
                
                .no-rain {{
                    background: #2ecc71;
                    color: white;
                }}
                
                .confidence-bar {{
                    background: #ecf0f1;
                    height: 30px;
                    border-radius: 15px;
                    overflow: hidden;
                    margin: 15px 0;
                }}
                
                .confidence-fill {{
                    height: 100%;
                    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                    transition: width 0.5s ease;
                }}
                
                .weather-details {{
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 15px;
                    margin-top: 20px;
                }}
                
                .detail-item {{
                    background: #f8f9fa;
                    padding: 12px;
                    border-radius: 10px;
                    text-align: center;
                }}
                
                .detail-label {{
                    font-size: 0.85em;
                    color: #7f8c8d;
                    margin-bottom: 5px;
                }}
                
                .detail-value {{
                    font-size: 1.2em;
                    font-weight: bold;
                    color: #2c3e50;
                }}
                
                .confidence-badge {{
                    display: inline-block;
                    padding: 5px 15px;
                    border-radius: 20px;
                    font-size: 0.9em;
                    font-weight: bold;
                    margin-left: 10px;
                }}
                
                .confidence-high {{
                    background: #2ecc71;
                    color: white;
                }}
                
                .confidence-medium {{
                    background: #f39c12;
                    color: white;
                }}
                
                .confidence-low {{
                    background: #e74c3c;
                    color: white;
                }}
                
                .search-box {{
                    text-align: center;
                    margin-bottom: 30px;
                }}
                
                .search-input {{
                    padding: 15px 25px;
                    font-size: 1.1em;
                    border: none;
                    border-radius: 50px;
                    width: 300px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                }}
                
                .search-button {{
                    padding: 15px 35px;
                    font-size: 1.1em;
                    background: white;
                    color: #667eea;
                    border: none;
                    border-radius: 50px;
                    cursor: pointer;
                    margin-left: 10px;
                    font-weight: bold;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    transition: all 0.3s ease;
                }}
                
                .search-button:hover {{
                    background: #667eea;
                    color: white;
                    transform: translateY(-2px);
                    box-shadow: 0 7px 20px rgba(0,0,0,0.3);
                }}
                
                @media (max-width: 768px) {{
                    .header h1 {{
                        font-size: 1.8em;
                    }}
                    
                    .days-grid {{
                        grid-template-columns: 1fr;
                    }}
                    
                    .search-input {{
                        width: 200px;
                        font-size: 1em;
                    }}
                }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1>üå¶Ô∏è Rain Forecast</h1>
                    <div class="location">üìç {location['name']}, {location['region']}, {location['country']}</div>
                </div>
                
                <div class="search-box">
                    <form action="/rain-forecast" method="get">
                        <input type="text" name="city" placeholder="Enter city name..." class="search-input" value="{city}">
                        <button type="submit" class="search-button">Check Weather</button>
                    </form>
                </div>
                
                <div class="summary-card">
                    <div class="summary-header">
                        <div class="rain-status {'rain-yes' if overall_will_rain else 'rain-no'}">
                            {'‚òî YES, It Will Rain!' if overall_will_rain else '‚òÄÔ∏è NO Rain Expected'}
                        </div>
                        <div class="probability">{round(max_rain_prob)}% Rain Probability</div>
                    </div>
                    
                    <div class="recommendation">
                        <span class="recommendation-icon">üí°</span>
                        <strong>Recommendation:</strong> 
                        {
                            "Pack an umbrella! High chance of rain - plan indoor activities or bring rain gear." if max_rain_prob >= 70 
                            else "Keep an umbrella handy. Moderate chance of rain - check forecast before outdoor plans." if max_rain_prob >= 50
                            else "You're good to go! Low chance of rain - enjoy outdoor activities!"
                        }
                    </div>
                </div>
                
                <div class="days-grid">
        """
        
        # Add cards for each day
        for pred in predictions:
            rain_emoji = "üåßÔ∏è" if pred['will_rain'] else "‚òÄÔ∏è"
            card_accent = "#3498db" if pred['will_rain'] else "#2ecc71"
            
            html += f"""
                    <div class="day-card">
                        <div class="day-header">
                            <div>
                                <div class="day-name">{pred['day_name']}</div>
                                <div style="color: #7f8c8d; font-size: 0.9em;">{pred['date']}</div>
                            </div>
                            <img src="https:{pred['icon']}" alt="{pred['condition']}" class="weather-icon">
                        </div>
                        
                        <div style="text-align: center; margin: 20px 0;">
                            <div class="prediction-badge {'will-rain' if pred['will_rain'] else 'no-rain'}">
                                {rain_emoji} {'RAIN EXPECTED' if pred['will_rain'] else 'NO RAIN'}
                            </div>
                            <div style="font-size: 2em; font-weight: bold; color: {card_accent}; margin: 10px 0;">
                                {round(pred['rain_prob'])}%
                            </div>
                            <div style="color: #7f8c8d;">
                                Confidence: <span class="confidence-badge confidence-{pred['confidence'].lower()}">{pred['confidence']}</span>
                            </div>
                        </div>
                        
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: {pred['rain_prob']}%;">
                                {round(pred['rain_prob'])}% Probability
                            </div>
                        </div>
                        
                        <div class="weather-details">
                            <div class="detail-item">
                                <div class="detail-label">üå°Ô∏è Temperature</div>
                                <div class="detail-value">{pred['max_temp']}¬∞C / {pred['min_temp']}¬∞C</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">üíß Humidity</div>
                                <div class="detail-value">{pred['humidity']}%</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">üåßÔ∏è Precipitation</div>
                                <div class="detail-value">{pred['precipitation']} mm</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">‚òÅÔ∏è Condition</div>
                                <div class="detail-value" style="font-size: 0.9em;">{pred['condition']}</div>
                            </div>
                        </div>
                        
                        {'<div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 10px; text-align: center; color: #856404;"><strong>‚ö†Ô∏è ' + pred["intensity"] + ' Rain Expected</strong></div>' if pred['will_rain'] else ''}
                    </div>
            """
        
        html += """
                </div>
                
                <div style="text-align: center; margin-top: 40px; color: white; opacity: 0.8;">
                    <p>ü§ñ Powered by Machine Learning Weather Prediction Model</p>
                    <p style="font-size: 0.9em; margin-top: 10px;">Using meteorological parameters: Humidity, Pressure, Cloud Cover, Precipitation</p>
                </div>
            </div>
        </body>
        </html>
        """
        
        return html
        
    except Exception as e:
        return f"<h1>Error: {str(e)}</h1>", 500


@app.route("/model-info", methods=["GET"])
def model_info():
    """Get information about the prediction model"""
    return jsonify({
        "model_name": "Rain Prediction Model v1.0",
        "model_type": "Weighted Meteorological Scoring System",
        "description": "Predicts rain probability based on multiple weather parameters",
        "input_parameters": {
            "chance_of_rain": {
                "weight": "35%",
                "description": "Weather API's forecast probability"
            },
            "humidity": {
                "weight": "20%",
                "description": "Average humidity percentage",
                "thresholds": ">80% = high rain probability"
            },
            "precipitation": {
                "weight": "25%",
                "description": "Total precipitation in mm",
                "scale": "5mm or more = 100% score"
            },
            "cloud_cover": {
                "weight": "10%",
                "description": "Cloud coverage percentage",
                "thresholds": ">75% = high rain probability"
            },
            "pressure": {
                "weight": "10%",
                "description": "Atmospheric pressure in mb",
                "thresholds": "<1000mb = high rain probability"
            }
        },
        "output": {
            "will_rain": "Boolean prediction (True/False)",
            "rain_probability": "0-100% score",
            "confidence": "Low/Medium/High based on prediction clarity"
        },
        "confidence_calculation": {
            "High": "Probability >80% or <20%",
            "Medium": "Probability 65-80% or 20-35%",
            "Low": "Probability 35-65% (uncertain zone)"
        }
    })


if __name__ == "__main__":
    print("üåßÔ∏è  Starting ML Rain Prediction Server...")
    print("üìä Model: Weighted Meteorological Scoring System")
    print("")
    print("üé® Beautiful HTML: http://127.0.0.1:5000/rain-forecast?city=Chennai")
    print("üìä JSON Endpoint: http://127.0.0.1:5000/predict-rain?city=Chennai")
    print("‚ÑπÔ∏è  Model Info: http://127.0.0.1:5000/model-info")
    print("")

    app.run(debug=True, host="127.0.0.1", port=5000)

